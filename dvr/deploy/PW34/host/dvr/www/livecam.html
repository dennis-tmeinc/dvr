<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
<meta content="Dennis Chen" name="author" />
<title>Live Camera View</title>
<script type="text/javascript" src="eagle3.js"></script>
<script type="text/javascript">
var singlescreen=-1 ;
var relo=0 ;
var ser=1 ;

var camera_number = <!--#include file="camera_number"--> ; 
var camera_name = new Array();
camera_name[0] = "<!--#exec cmd="/davinci/dvr/cfg get camera1 name" -->" ;
camera_name[1] = "<!--#exec cmd="/davinci/dvr/cfg get camera2 name" -->" ; 
camera_name[2] = "<!--#exec cmd="/davinci/dvr/cfg get camera3 name" -->" ; 
camera_name[3] = "<!--#exec cmd="/davinci/dvr/cfg get camera4 name" -->" ; 

var camera_live = new Array();
camera_live[0] = "cgi/mp4live?channel="+"<!--#exec cmd="/davinci/dvr/cfg get camera1 channel" -->";
camera_live[1] = "cgi/mp4live?channel="+"<!--#exec cmd="/davinci/dvr/cfg get camera2 channel" -->";
camera_live[2] = "cgi/mp4live?channel="+"<!--#exec cmd="/davinci/dvr/cfg get camera3 channel" -->";
camera_live[3] = "cgi/mp4live?channel="+"<!--#exec cmd="/davinci/dvr/cfg get camera4 channel" -->";

function badbrowser()
{
    if( navigator.appName.match(/Microsoft Internet Explorer/i) ) {
        if( document.documentMode ) {
            if( document.documentMode < 8 ) {
               return 1;    // bad
            }
            else {
               return 0 ;
            }
        }
        else {
            return 1 ;
        }
    }
    else {
	// all other browsers are good.
        return 0 ;
    }
}

function startchannel(channel)
{
    var vlc;
    vlc = document.getElementById("camobj"+channel);
    if( vlc ) {
	vlc.style.display="" ;
    }
    if( !vlc || !vlc.playlist ) {
	vlc = document.getElementById("camemb"+channel);
    }
    if( vlc && vlc.playlist ) {
	vlc.playlist.items.clear();
	vlc.playlist.add(camera_live[channel]);
	vlc.playlist.play();
    }
    else if( vlc ) {
	vlc.src=camera_live[channel];
    }
}

function stopchannel(channel)
{
   var vlc;
   vlc = document.getElementById("camobj"+channel);
   if( vlc && vlc.playlist ) {
       if( vlc.playlist.items.count > 0 ) {
	   if( vlc.playlist.isPlaying == true ) {
	      vlc.playlist.stop();
	   }
	   vlc.playlist.items.clear();
       }
   }
   else if( vlc ) {
      vlc.src="";
   }
   if( vlc ) {
       vlc.style.display="none" ;
   }
}

function livestart()
{
    var i;
    for( i=0 ; i<camera_number; i++ ) {
       stopchannel(i);
       if( document.getElementById("id_cam"+(i+1)).checked==true ) {
	    startchannel(i);
       }
    }
}

</script>
</head>

<body>

<object classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921"
  width="640" height="480"
  id="camobj0" >
 <param name="Src" value="" />
 <param name="ShowDisplay" value="True" />
 <param name="AutoLoop" value="False" />
 <param name="AutoPlay" value="False" />

<embed type="video/mp4"
    width="640"
    height="480"
    id="camemb0" />
</object>

<object classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921"
  width="640" height="480"
  id="camobj1" >
 <param name="Src" value="" />
 <param name="ShowDisplay" value="True" />
 <param name="AutoLoop" value="False" />
 <param name="AutoPlay" value="False" />

<embed type="video/mp4"
    width="640"
    height="480"
    id="camemb1" />
</object>

<object classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921"
  width="640" height="480"
  id="camobj2" >
 <param name="Src" value="" />
 <param name="ShowDisplay" value="True" />
 <param name="AutoLoop" value="False" />
 <param name="AutoPlay" value="False" />

<embed type="video/mp4"
    width="640"
    height="480"
    id="camemb2" />
</object>

<object classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921"
  width="640" height="480"
  id="camobj3" >
 <param name="Src" value="" />
 <param name="ShowDisplay" value="True" />
 <param name="AutoLoop" value="False" />
 <param name="AutoPlay" value="False" />

<embed type="video/mp4"
    width="640"
    height="480"
    id="camemb3" />
</object>

<p/>

<input id="id_cam1" value="on" type="checkbox" checked="checked" />
<label for="id_cam1" id="label_cam1">Camera 1</label>

<input id="id_cam2" value="on" type="checkbox" />
<label for="id_cam2" id="label_cam2">Camera 2</label>

<input id="id_cam3" value="on" type="checkbox" />
<label for="id_cam3" id="label_cam3">Camera 3</label>

<input id="id_cam4" value="on" type="checkbox" />
<label for="id_cam4" id="label_cam4">Camera 4</label>

<p />
<input type="button" id="startbutton" onclick="livestart()" value="ReStart" />
<input type="button" onclick="window.location.assign('system.html')" value="System Setup" />
<p/>
</body>
</html>
<script type="text/javascript">

for( i=1; i<=4; i++ ) {
   document.getElementById("label_cam"+i).innerHTML=camera_name[i-1] ;
}

setTimeout("livestart()", 2000);

</script>

